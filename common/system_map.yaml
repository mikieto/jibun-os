---
# common/system_map.yaml
#
# Jibun OSの全体的なファイル構造と、各ファイルの役割、および主要な依存関係を定義する。
# AIがOSの内部構造を理解し、自己監査や自動化を支援するための機械可読なマップ。
system_architecture:
  version: 3.1.0  # バージョンを更新
  layers:
    - name: common
      description: 誰でも再利用可能な、OSの核となる普遍的なフレームワークや定義。
      files:
        - path: common/constitution.yaml
          role: universal_constitution
          description: OSフレームワークの最高規範。統治機構、コア機能、運用哲学を定義。
          context_level: base_os_context
          dependencies:
            - ../docs/charter.md  # 憲章の理念を実装
            - common/taxonomy.yaml
            - common/implementation_framework.yaml
        - path: common/immune_system.yaml
          role: intellectual_immune_system_framework
          description: OSの自己防衛・自己成長メカニズム（生得免疫系）を定義する、普遍的なフレームワーク。
          context_level: base_os_context
          dependencies: []
        - path: common/mappings.yaml
          role: component_mappings
          description: OS内の異なるコンポーネント間の関連性を定義。
          context_level: base_os_context
          dependencies: [common/constitution.yaml, common/immune_system.yaml]
        - path: common/implementation_framework.yaml
          role: implementation_framework
          description: OS運用、知識の循環プロセス（結晶化・普遍化）など、標準プロセスを定義。
          context_level: base_os_context
          dependencies: [common/taxonomy.yaml]
        - path: common/taxonomy.yaml
          role: system_taxonomy
          description: 四階層モデルなど、OS全体で共有されるタグや分類を定義。
          context_level: base_os_context
          dependencies: []
        - path: common/prompt_patterns.yaml
          role: ai_interface_patterns
          description: (計画中) AIとの協働モデルを実装するための標準化されたプロンプトの型を定義。
          status: planned
          context_level: future_context
          dependencies: [common/constitution.yaml]
        - path: common/legislation/project_template.yaml
          role: playbook_template_project
          description: 第二階層(Legislation)に属する、新規プロジェクト作成時の共通テンプレート。
          context_level: template_data
          dependencies: []
        - path: common/legislation/domain_template.yaml
          role: playbook_template_domain
          description: 第二階層(Legislation)に属する、新規ドメイン作成時の共通テンプレート。
          context_level: template_data
          dependencies: []
    - name: personal
      description: OS所有者固有の価値観、設定、および具体的な実装。
      files:
        - path: personal/constitution.yaml  # 追加
          role: personal_constitution  # 追加
          description: OS所有者個人の究極の目的や核となる価値観を定義する。
          context_level: base_os_context
          dependencies: [../common/constitution.yaml]
        - path: personal/core_principles.yaml
          role: personal_implementation_config  # 役割を修正
          description: 個人のOSインスタンスの具体的な設定、役割、ガードの詳細、KPI、改善バックログなどを定義。  # 説明を修正
          context_level: base_os_context
          dependencies:
            - ../common/constitution.yaml
            - ./constitution.yaml  # personal/constitution.yamlへの依存を追加
        - path: personal/acquired_immunity.yaml
          role: personal_adaptive_rules
          description: 個人的な経験から獲得した、特異的なルール（抗体）の集合。
          context_level: personal_data
          dependencies: [common/immune_system.yaml]
        - path: personal/profile.yaml
          role: personal_profile
          description: OS所有者の固定的なプロフィール（名前、タイムゾーンなど）を定義。
          context_level: personal_data
          dependencies: []
        - path: personal/projects/os_platform.yaml
          role: os_development_project
          description: Jibun OSプラットフォーム自体の開発プロジェクト定義、バージョン、ステージ、開発バックログを管理。
          context_level: base_os_context
          dependencies: []
        - path: personal/domains/learning.yaml
          role: user_domain_instance
          description: OS所有者の学習領域に関する定義。
          context_level: domain_context
          dependencies: [common/legislation/domain_template.yaml]
    - name: logs
      description: OSの運用中に動的に生成される、行動や決定に関するログデータ。
      files:
        - path: logs/task_log.yaml
          role: task_log
          description: タスクの進捗を記録。
          context_level: log_data
          dependencies: []
        - path: logs/decision_log.yaml
          role: decision_log
          description: 重要な意思決定の「なぜ」を記録。
          context_level: log_data
          dependencies: [logs/task_log.yaml]
        - path: logs/guard_log.yaml
          role: guard_invocation_log
          description: 知的免疫システムの発動記録や、AIとの対話履歴などを動的に記録。
          context_level: log_data
          dependencies:
            - common/immune_system.yaml
            - personal/acquired_immunity.yaml
  other_root_files:
    - path: docs/charter.md
      role: system_charter
      description: デジタルツインの理念、構造、運用を定義する最高規範。全てのコンポーネントはこの憲章の思想に従う。
      context_level: documentation
      dependencies: []  # common/system_map.yamlへの依存を削除
    - path: .github/workflows/validate.yaml
      role: ci_workflow
      description: CI/CDワークフロー定義。OSの構造、スキーマ、lintなどを検証。
      context_level: operational_tooling
      dependencies: []
    - path: docs/architecture_overview.md
      role: system_documentation
      description: OSの技術的なアーキテクチャ概要。docs/charter.mdを補完する、人間が読むための設計ドキュメント。
      context_level: documentation
      dependencies: [common/system_map.yaml, docs/charter.md]
    - path: README.md
      role: project_readme
      description: プロジェクトの概要と導入手順。
      context_level: documentation
      dependencies: []
    - path: requirements.txt
      role: python_dependencies
      description: Pythonプロジェクトの依存ライブラリリスト。
      context_level: operational_tooling
      dependencies: []

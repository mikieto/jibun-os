---
system_architecture:
  version: 3.1.0
  description: Prompt‑Ingestion & Digital‑Twin unified map
  layers:
    # ---------- L1 : constitution ----------
    - name: constitution
      description: OS の最高規範 (普遍憲法＋個人憲法)
      files:
        - path: constitution/common/constitution.yaml
          role: universal_constitution
          description: OS フレームワークの最高規範
          context_level: base_os_context
          dependencies:
            - constitution/common/mvc_v1.0.yaml
            - constitution/common/udhr.yaml
            - docs/charter.md
            - legislation/common/taxonomy.yaml
            - legislation/common/implementation_framework.yaml
        - path: constitution/common/mvc_v1.0.yaml
          role: ai_governance_framework
          description: 実用最小限のAI統治憲法（MVC）の原則定義
          context_level: base_os_context
          dependencies: [constitution/common/udhr.yaml]
        - path: constitution/common/udhr.yaml
          role: universal_human_rights_standard
          description: 世界人権宣言に基づく普遍的な人権規範
          context_level: base_os_context
          dependencies: []
        - path: constitution/personal/constitution.yaml
          role: personal_constitution
          description: 個人の核となる価値観・目的
          context_level: base_os_context
          dependencies:
            - constitution/common/constitution.yaml

    # ---------- L2 : legislation ----------
    - name: legislation
      description: 憲法に基づく具体ルール・テンプレート
      files:
        # --- 共通 ---
        - path: legislation/common/immune_system.yaml
          role: intellectual_immune_system_framework
          description: 生得免疫系フレームワーク
          context_level: base_os_context
          dependencies: []
        - path: legislation/common/innate_immunity.yaml
          role: universal_guards
          description: 共通ガードルール
          context_level: base_os_context
          dependencies: []

        - path: legislation/common/jurisprudence.yaml
          role: general_legal_principles
          description: AIが従うべき法の一般原則（信義誠実、適正手続き等）
          context_level: base_os_context
          dependencies: []

        - path: legislation/common/mappings/guards.yaml
          context_level: tooling
          description: Guard ID ↔ Guard 定義
        - path: legislation/common/mappings/field_task_decision.yaml
          context_level: tooling
          description: Task ↔ Decision mapping (skeleton)
        - path: legislation/common/mappings/field_kpi_ci.yaml
          context_level: tooling
          description: KPI ← CI mapping (skeleton)
        - path: legislation/common/mappings/driver_stub.yaml
          context_level: tooling
          description: driver stub

        - path: legislation/common/implementation_framework.yaml
          role: implementation_framework
          description: 結晶化・普遍化など標準プロセス
          context_level: base_os_context
          dependencies: [legislation/common/taxonomy.yaml]
        - path: legislation/common/taxonomy.yaml
          role: system_taxonomy
          description: OS 全体のタグ／分類
          context_level: base_os_context
          dependencies: []
        - path: legislation/common/prompt_patterns.yaml
          role: ai_interface_patterns
          status: planned
          description: AI 協働用プロンプト標準型
          context_level: future_context
          dependencies: [constitution/common/constitution.yaml]

        # --- テンプレート ---
        - path: legislation/common/projects/project_template.yaml
          role: playbook_template_project
          context_level: template_data
          description: プロジェクト作成テンプレ
          dependencies: []
        - path: legislation/common/domains/domain_template.yaml
          role: playbook_template_domain
          context_level: template_data
          description: ドメイン作成テンプレ
          dependencies: []

        # --- 個人 ---
        - path: legislation/personal/core_principles.yaml
          role: personal_implementation_config
          context_level: base_os_context
          description: 個人 OS の設定・KPI 等
          dependencies:
            - constitution/common/constitution.yaml
            - constitution/personal/constitution.yaml
        - path: legislation/personal/acquired_immunity.yaml
          role: personal_adaptive_rules
          context_level: personal_data
          description: 獲得免疫ルール（個人）
          dependencies: [legislation/common/immune_system.yaml]
        - path: legislation/personal/profile.yaml
          role: personal_profile
          context_level: personal_data
          description: 固定プロフィール
          dependencies: []

        # --- Jibun OS 開発プロジェクト ---
        - path: legislation/personal/projects/os_platform.yaml
          role: os_development_project
          description: Jibun OS プラットフォーム憲章＋実装メタ
          context_level: base_os_context
          roadmap_phase: stabilize
          dependencies:
            - records/decision_log.yaml
            - records/task_log.yaml

        # --- サンプルユーザードメイン ---
        - path: legislation/personal/domains/learning.yaml
          role: user_domain_instance
          context_level: domain_context
          description: 学習ドメイン定義
          dependencies: [legislation/common/domains/domain_template.yaml]

    # ---------- L3 : precedents ----------
    - name: precedents
      description: 抽象化された知識・行動パターン（現在空）
      files: []

    # ---------- L4 : records ----------
    - name: records
      description: 実行ログ・決定ログ
      files:
        - path: records/task_log.yaml
          role: task_log
          context_level: log_data
          description: タスクの進捗履歴
          dependencies: []
        - path: records/decision_log.yaml
          role: decision_log
          context_level: log_data
          description: 重要意思決定の履歴
          dependencies: [records/task_log.yaml]
        - path: records/guard_log.yaml
          role: guard_invocation_log
          context_level: log_data
          description: 知的免疫システム発動＆AI対話履歴
          dependencies:
            - legislation/common/immune_system.yaml
            - legislation/personal/acquired_immunity.yaml
  other_root_files:
    - path: docs/charter.md
      role: system_charter
      context_level: documentation
      description: システムの最高理念ドキュメント
      dependencies: []
    - path: .github/workflows/validate.yaml
      role: ci_workflow
      context_level: operational_tooling
      description: 構造・スキーマ・lint 検証
      dependencies: []
    - path: docs/architecture_overview.md
      role: system_documentation
      context_level: documentation
      description: 技術アーキテクチャ概要
      dependencies: [system_map.yaml, docs/charter.md]
    - path: README.md
      role: project_readme
      context_level: documentation
      description: プロジェクト概要・導入手順
      dependencies: []
    - path: requirements.txt
      role: python_dependencies
      context_level: operational_tooling
      description: Python 依存ライブラリ
      dependencies: []
    - path: schema/os_architecture.schema.json
      role: os_schema_definition
      context_level: operational_tooling
      description: YAML/JSON スキーマ
      dependencies: []

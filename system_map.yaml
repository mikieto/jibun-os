---
system_architecture:
  version: 3.1.0
  description: Prompt‑Ingestion & Digital‑Twin unified map
  layers:
    # ---------- L1 : constitution ----------
    - name: constitution
      description: OS の最高規範 (普遍憲法＋個人憲法)
      files:
        - path: constitution/common/constitution.yaml
          role: universal_constitution
          description: OS フレームワークの最高規範
          context_level: base_os_context
          dependencies:
            - constitution/common/mvc_v1.0.yaml
            - constitution/common/udhr.yaml
            - docs/charter.md
            - legislation/common/taxonomy.yaml
            - legislation/common/implementation_framework.yaml
        - path: constitution/common/mvc_v1.0.yaml
          role: ai_governance_framework
          description: 実用最小限のAI統治憲法（MVC）の原則定義
          context_level: base_os_context
          dependencies: [constitution/common/udhr.yaml]
        - path: constitution/common/udhr.yaml
          role: universal_human_rights_standard
          description: 世界人権宣言に基づく普遍的な人権規範
          context_level: base_os_context
          dependencies: []
        - path: constitution/personal/constitution.yaml
          role: personal_constitution
          description: 個人の核となる価値観・目的
          context_level: base_os_context
          dependencies:
            - constitution/common/constitution.yaml

    # ---------- L2 : legislation ----------
    - name: legislation
      description: 憲法に基づく具体ルール・テンプレート
      files:
        # --- 共通 ---
        - path: legislation/common/immune_system.yaml
          role: intellectual_immune_system_framework
          description: 知的免疫系フレームワーク
          context_level: base_os_context
          dependencies: []
        - path: legislation/common/innate_immunity.yaml
          role: universal_guards
          description: 共通ガードルール
          context_level: base_os_context
          dependencies: []
        - path: legislation/common/jurisprudence.yaml
          role: general_legal_principles
          description: AIが従うべき法の一般原則（信義誠実、適正手続き等）
          context_level: base_os_context
          dependencies: []
        - path: legislation/common/critical_dialogue_protocol.yaml
          role: ai_critical_dialogue_protocol
          description: AI協働における自己欺瞞や思考の停滞を防ぎ、対話の質を保証するための公式プロトコル
          context_level: base_os_context
          dependencies:
            - constitution/common/constitution.yaml  # AI roles and G013 are defined here
            - legislation/common/innate_immunity.yaml  # For G013 integration
        - path: legislation/common/mappings/guards.yaml
          context_level: tooling
          description: Guard ID ↔ Guard 定義
        - path: legislation/common/mappings/field_task_decision.yaml
          context_level: tooling
          description: Task ↔ Decision mapping (skeleton)
        - path: legislation/common/mappings/field_kpi_ci.yaml
          context_level: tooling
          description: KPI ← CI mapping (skeleton)
        - path: legislation/common/mappings/driver_stub.yaml
          context_level: tooling
          description: driver stub
        - path: legislation/common/implementation_framework.yaml
          role: implementation_framework
          description: 結晶化・普遍化など標準プロセス
          context_level: base_os_context
          dependencies: [legislation/common/taxonomy.yaml]
        - path: legislation/common/communication_principles.yaml
          role: external_communication_principles
          description: 外部への価値伝達を最適化する原則
          context_level: base_os_context
          dependencies: []
        - path: legislation/common/taxonomy.yaml
          role: system_taxonomy
          description: OS 全体のタグ／分類
          context_level: base_os_context
          dependencies: []
        - path: legislation/common/prompt_patterns.yaml
          role: ai_interface_patterns
          status: planned
          description: AI 協働用プロンプト標準型
          context_level: future_context
          dependencies: [constitution/common/constitution.yaml]
        - path: legislation/common/kpi.yaml
          role: kpi_definitions
          description: プロジェクトおよびOS全体のKPI定義
          context_level: base_os_context
          dependencies:
            - legislation/personal/projects/os_platform.yaml
            - constitution/common/constitution.yaml
        - path: legislation/common/impact_assessment_framework.yaml
          role: impact_assessment_framework
          description: 意思決定の影響を評価するための、OS共通の5軸評価フレームワーク定義。
          context_level: base_os_context
          dependencies: []
        - path: legislation/common/collaboration_protocol.yaml
          description: AIとの協働における標準的な手順や規約を定義する。
          context_level: base_os_context
        - path: legislation/common/standard_operating_procedures.yaml
          role: standard_operating_procedures
          description: OSの運用に関する標準的な作業手順を定義する。
          context_level: base_os_context

        # --- テンプレート ---
        - path: legislation/common/projects/project_template.yaml
          role: playbook_template_project
          context_level: template_data
          description: プロジェクト作成テンプレ
          dependencies: []
        - path: legislation/common/domains/domain_template.yaml
          role: playbook_template_domain
          context_level: template_data
          description: ドメイン作成テンプレ
          dependencies: []

        # --- 個人 ---
        - path: legislation/personal/core_principles.yaml
          role: personal_implementation_config
          context_level: base_os_context
          description: 個人 OS の設定・KPI 等
          dependencies:
            - constitution/common/constitution.yaml
            - constitution/personal/constitution.yaml
        - path: legislation/personal/acquired_immunity.yaml
          role: personal_adaptive_rules
          context_level: personal_data
          description: 獲得免疫ルール（個人）
          dependencies: [legislation/common/immune_system.yaml]
        - path: legislation/personal/profile.yaml
          role: personal_profile
          context_level: personal_data
          description: 固定プロフィール
          dependencies: []

        # --- Jibun OS 開発プロジェクト ---
        - path: legislation/personal/projects/os_platform.yaml
          role: os_development_project
          description: Jibun OS プラットフォーム憲章＋実装メタ
          context_level: base_os_context
          roadmap_phase: stabilize
          dependencies: [records/decision_log.yaml, records/task_log.yaml]
        # --- 転職活動プロジェクト ---
        - path: legislation/personal/projects/job_search_2025.yaml
          role: career_development_project  # 新規に役割を定義
          description: |
            転職活動2025（Job Search 2025）の目的、ロードマップ、KPI、リスクを定義するプロジェクト憲章。
            OSの自己探求という究極目的を、キャリア選択という具体的な活動で実践するためのSSOT。
          context_level: base_os_context  # 他の憲章と統一
          dependencies:
            - constitution/common/constitution.yaml
            - legislation/common/impact_assessment_framework.yaml
            - legislation/personal/core_principles.yaml

        # --- サンプルユーザードメイン ---
        - path: legislation/personal/domains/learning.yaml
          role: user_domain_instance
          context_level: domain_context
          description: 学習ドメイン定義
          dependencies: [legislation/common/domains/domain_template.yaml]

    # ---------- L3 : precedents ----------
    - name: precedents
      description: 抽象化された知識・行動パターン（判例）
      files:
        - path: precedents/*.yaml
          role: crystallized_knowledge
          description: 過去の経験から抽出された、未来の意思決定の指針となる高価値な洞察（判例）
          context_level: precedent_data
          dependencies: [records/decision_log.yaml, records/task_log.yaml]

    # ---------- L4 : records ----------
    - name: records
      description: 実行ログ・決定ログ
      files:
        - path: records/task_log.yaml
          role: task_log
          context_level: log_data
          description: タスクの進捗履歴
          ssot: true
          dependencies: []
        - path: records/decision_log.yaml
          role: decision_log
          context_level: log_data
          description: 重要意思決定の履歴
          ssot: true
          dependencies: [records/task_log.yaml]
        - path: records/guard_log.yaml
          role: guard_invocation_log
          context_level: log_data
          description: 知的免疫システム発動＆AI対話履歴
          dependencies:
            - legislation/common/immune_system.yaml
            - legislation/personal/acquired_immunity.yaml
  other_root_files:
    - path: docs/charter.md
      role: system_charter
      context_level: documentation
      description: システムの最高理念ドキュメント
      dependencies: []
    - path: ai_base_context.yaml
      role: base_context_artifact
      context_level: operational_tooling
      description: AI常時読み込み用の生成物（直編集禁止）
      generated: true
      generator: scripts/get_base_os_context.py
      regenerate_on: [constitution/**, legislation/**, records/**]
      enforce_self_review: true
      dependencies: []
    - path: .github/workflows/validate.yaml
      role: ci_workflow
      context_level: operational_tooling
      description: 構造・スキーマ・lint 検証
      dependencies: []
    - path: docs/architecture_overview.md
      role: system_documentation
      context_level: documentation
      description: 技術アーキテクチャ概要
      dependencies: [system_map.yaml, docs/charter.md]
    - path: README.md
      role: project_readme
      context_level: documentation
      description: プロジェクト概要・導入手順
      dependencies: []
    - path: requirements.txt
      role: python_dependencies
      context_level: operational_tooling
      description: Python 依存ライブラリ
      dependencies: []
    - path: schema/os_architecture.schema.json
      role: os_schema_definition
      context_level: operational_tooling
      description: YAML/JSON スキーマ
      dependencies: []
